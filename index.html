<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Index PRO+ ‚Äì TikTok Feed Intelligence</title>

<style>
body{margin:0;font-family:system-ui;background:#f1f5f9}
header{background:#020617;color:#fff;padding:20px}
.container{max-width:1500px;margin:auto;padding:20px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
.card{background:#fff;border-radius:16px;padding:18px;box-shadow:0 6px 20px rgba(0,0,0,.08)}
.stat{font-size:30px;font-weight:900}
.badge{padding:4px 10px;border-radius:20px;font-size:12px;background:#e5e7eb}
table{width:100%;border-collapse:collapse}
th,td{padding:12px;border-bottom:1px solid #eee}
th{background:#f8fafc}
.foi{font-size:22px;font-weight:900}

button,input,select,textarea{
  padding:10px;
  border-radius:10px;
  border:1px solid #cbd5f5;
  font-family:inherit;
}
button{background:#020617;color:#fff;cursor:pointer}
button.secondary{background:#475569}
button.danger{background:#dc2626}
textarea{width:100%;min-height:160px}
small{color:#64748b}
hr{border:none;border-top:1px solid #e5e7eb;margin:12px 0}

/* ================= CATEGORY SCROLL (UPDATED) ================= */
.cat-scroll{
  max-height:260px;              /* ‡πÅ‡∏™‡∏î‡∏á ~5-6 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ */
  overflow-y:auto;
  padding-right:6px;
  -webkit-overflow-scrolling:touch; /* mobile smooth */
  border-top:1px dashed #e5e7eb;
}

/* scrollbar style (desktop) */
.cat-scroll::-webkit-scrollbar{
  width:6px;
}
.cat-scroll::-webkit-scrollbar-thumb{
  background:#c7d2fe;
  border-radius:10px;
}

.cat-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
</style>
</head>

<body>

<header>
  <h1>üöÄ Index PRO+ ‚Äì Feed Opportunity Index</h1>
  <small>Kalodata-style | Affiliate Intelligence | No API</small>
</header>

<div class="container">

<!-- DASHBOARD -->
<div class="grid">
  <div class="card"><h3>üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3><div class="stat" id="total">0</div></div>
  <div class="card"><h3>üöÄ FOI ‚â• 75</h3><div class="stat" id="easy">0</div></div>
  <div class="card"><h3>üí∞ ROI ‡∏™‡∏π‡∏á</h3><div class="stat" id="roiHigh">0</div></div>
  <div class="card"><h3>üî• ‡∏´‡∏°‡∏ß‡∏î‡∏°‡∏≤‡πÅ‡∏£‡∏á</h3><div class="stat" id="topCat">-</div></div>
</div>

<br>

<!-- FILTER -->
<div class="card">
  <input id="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
  <select id="catFilter"></select>
  <button onclick="apply()">Filter</button>
  <button class="secondary" onclick="exportCSV()">Export CSV</button>
  <button class="danger" onclick="clearData()">üßπ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</div>

<br>

<!-- CATEGORY -->
<div class="card">
  <h3>üóÇ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h3>

  <input id="catName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î ‡πÄ‡∏ä‡πà‡∏ô Topper Premium">
  <input id="catRegex" placeholder="Keyword / Regex ‡πÄ‡∏ä‡πà‡∏ô topper|‡∏ó‡πá‡∏≠‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå">
  <button onclick="addCategory()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î</button>

  <hr>

  <!-- ‚úÖ SCROLLABLE LIST -->
  <div id="catList" class="cat-scroll"></div>
</div>

<br>

<!-- TABLE -->
<div class="card">
<table>
<thead>
<tr>
<th>#</th><th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏´‡∏°‡∏ß‡∏î</th>
<th>FOI</th><th>ROI</th><th>Sell</th><th>Feed</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
</tr>
</thead>
<tbody id="tb"></tbody>
</table>
</div>

<br>

<!-- GPT -->
<div class="card">
  <h3>üß† Send to GPT</h3>
  <textarea id="gptPrompt"></textarea>
  <button onclick="sendToGPT()">üì§ Copy & Open ChatGPT</button>
</div>

</div>

<script>
/* ================= CONFIG ================= */
const DB_ROOT="https://index-pro-tiktok-default-rtdb.asia-southeast1.firebasedatabase.app";
const IMPORT_PATH="/imports.json";

/* ================= CATEGORY ================= */
const CAT_KEY="INDEX_PRO_CATEGORIES";
const DEFAULT_CATS=[
  {name:"Topper",regex:"topper|‡∏ó‡πá‡∏≠‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå"},
  {name:"‡∏ú‡πâ‡∏≤‡∏õ‡∏π‡∏ó‡∏µ‡πà‡∏ô‡∏≠‡∏ô",regex:"‡∏ú‡πâ‡∏≤‡∏õ‡∏π|bed sheet"},
  {name:"‡∏´‡∏°‡∏≠‡∏ô",regex:"‡∏´‡∏°‡∏≠‡∏ô|pillow"},
  {name:"‡∏ú‡πâ‡∏≤‡∏´‡πà‡∏°",regex:"‡∏ú‡πâ‡∏≤‡∏´‡πà‡∏°|blanket"},
  {name:"Premium Bedding",regex:"premium"}
];

let CATEGORIES=JSON.parse(localStorage.getItem(CAT_KEY))||DEFAULT_CATS;
let DATA=[];

/* ================= CATEGORY CRUD ================= */
function saveCat(){
  localStorage.setItem(CAT_KEY,JSON.stringify(CATEGORIES));
  renderCatManager();
  reloadCategory();
}
function addCategory(){
  if(!catName.value||!catRegex.value) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
  CATEGORIES.unshift({name:catName.value,regex:catRegex.value});
  catName.value="";catRegex.value="";
  saveCat();
}
function removeCategory(i){
  if(!confirm("‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ?")) return;
  CATEGORIES.splice(i,1);
  saveCat();
}
function renderCatManager(){
  catList.innerHTML="";
  CATEGORIES.forEach((c,i)=>{
    catList.innerHTML+=`
      <div class="cat-item">
        <div><strong>${c.name}</strong><br><small>${c.regex}</small></div>
        <button class="danger" onclick="removeCategory(${i})">‡∏•‡∏ö</button>
      </div>`;
  });
}

/* ================= CATEGORY AUTO ================= */
function autoCategory(name="",price=0){
  name=name.toLowerCase();
  for(const c of CATEGORIES){
    if(new RegExp(c.regex,"i").test(name)) return c.name;
  }
  if(price>1000) return "Premium Bedding";
  return "Home & Sleep";
}

/* ================= SCORE ================= */
const sellScore=p=>Math.round(Math.min((p.avgViews||0)/1200,30)+Math.min((p.engagement||0)*4,30));
const feedScore=p=>Math.round(Math.min((p.avgViews||0)/1000,30)+Math.min((p.engagement||0)*5,25));
const FOI=p=>Math.round(sellScore(p)*0.4+feedScore(p)*0.6);
const roiScore=p=>Math.round(p.foi*0.6+(p.engagement||0.1)*20);

/* ================= LOAD ================= */
async function load(){
  const r=await fetch(DB_ROOT+IMPORT_PATH);
  const json=await r.json();
  DATA=[];
  if(!json) return;

  Object.values(json).forEach(b=>{
    (b.items||[]).forEach(p=>{
      p.shop=p.shop||p.shop_name||p.seller_name||"-";
      p.category=autoCategory(p.name,p.price);
      p.sell=sellScore(p);
      p.feed=feedScore(p);
      p.foi=FOI(p);
      p.roi=roiScore(p);
      DATA.push(p);
    });
  });
  reloadCategory();
}

/* ================= UI ================= */
function reloadCategory(){
  dashboard();filterCat();render(DATA);buildGPT();
}
function dashboard(){
  total.innerText=DATA.length;
  easy.innerText=DATA.filter(p=>p.foi>=75).length;
  roiHigh.innerText=DATA.filter(p=>p.roi>=70).length;
  const c={};DATA.forEach(p=>c[p.category]=(c[p.category]||0)+1);
  topCat.innerText=Object.entries(c).sort((a,b)=>b[1]-a[1])[0]?.[0]||"-";
}
function filterCat(){
  catFilter.innerHTML='<option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î</option>';
  [...new Set(DATA.map(p=>p.category))].forEach(c=>catFilter.innerHTML+=`<option>${c}</option>`);
}
function apply(){
  const q=search.value.toLowerCase(),c=catFilter.value;
  render(DATA.filter(p=>(!q||p.name.toLowerCase().includes(q))&&(!c||p.category===c)));
}
function render(list){
  tb.innerHTML="";
  list.sort((a,b)=>b.foi-a.foi).forEach((p,i)=>{
    tb.innerHTML+=`
<tr>
<td>#${i+1}</td>
<td>${p.name}<br><small>${p.shop}</small></td>
<td><span class="badge">${p.category}</span></td>
<td class="foi">${p.foi}</td>
<td>${p.roi}</td>
<td>${p.sell}</td>
<td>${p.feed}</td>
<td>${p.roi>=70?"üí∞":"‚ö†Ô∏è"}</td>
</tr>`;
  });
}

/* ================= GPT ================= */
function buildGPT(){
  gptPrompt.value=DATA.slice(0,10)
    .map((p,i)=>`${i+1}. ${p.name} | ‡∏£‡πâ‡∏≤‡∏ô:${p.shop} | FOI:${p.foi}`)
    .join("\n");
}
function sendToGPT(){
  navigator.clipboard.writeText(gptPrompt.value);
  window.open("https://chat.openai.com","_blank");
}

/* ================= CLEAR ================= */
async function clearData(){
  if(!confirm("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?"))return;
  await fetch(DB_ROOT+IMPORT_PATH,{method:"DELETE"});
  DATA=[];reloadCategory();
}

/* ================= INIT ================= */
renderCatManager();
load();
</script>

</body>
</html>