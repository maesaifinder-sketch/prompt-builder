<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Prompt Builder PRO+</title>
<style>
body{
  margin:0;
  font-family:system-ui;
  background:#f2f2f2;
}
.container{
  display:flex;
  height:100vh;
}

/* LEFT */
.left{
  width:70%;
  padding:12px;
  margin-right:30%;
  overflow:auto;
}

/* RIGHT */
.right{
  width:30%;
  background:#111;
  color:#0f0;
  padding:12px;
  position:fixed;
  right:0;
  top:0;
  height:100%;
  display:flex;
  flex-direction:column;
  gap:8px;
}

/* TOP BAR */
.topbar{
  display:flex;
  gap:6px;
  margin-bottom:12px;
  position:sticky;
  top:0;
  background:#f2f2f2;
  z-index:10;
}

.btn-blue{background:#007bff;color:#fff}
.btn-purple{background:#6f42c1;color:#fff}
.btn-green{background:#28a745;color:#fff}
.btn-orange{background:#fd7e14;color:#fff}

/* CARD */
.card{
  background:#fff;
  border-radius:10px;
  padding:12px;
  margin-bottom:12px;
  border-left:5px solid #ddd;
}
.card.active{
  border-left:5px solid #28a745;
  box-shadow:0 0 0 2px #28a74533;
}

.group{
  border:2px dashed #bbb;
  padding:10px;
  border-radius:10px;
  margin-bottom:12px;
}

h2{
  margin:0 0 6px 0;
  font-size:16px;
}

select,input,textarea,button{
  width:100%;
  padding:8px;
  margin-top:6px;
  border-radius:6px;
  border:1px solid #ccc;
}

.row{
  display:flex;
  gap:6px;
  margin-top:6px;
}

.add{background:#28a745;color:#fff;border:none}
.del{
  background:#dc3545;
  color:#fff;
  border:none;
  flex:0.5;
}
.copy{background:#6c757d;color:#fff;border:none}
.send{
  background:#0d6efd;
  color:#fff;
  border:none;
}

/* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (textarea) ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ 55% ‡πÅ‡∏•‡πâ‡∏ß */
.output{
  height:auto;
  min-height:140px;      /* ‡∏Å‡∏±‡∏ô‡πÄ‡∏ï‡∏µ‡πâ‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô */
  flex:1;                /* ‡πÉ‡∏´‡πâ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ */
  background:#000;
  color:#0f0;
  font-family:monospace;
}

/* ‡∏õ‡∏£‡∏±‡∏ö log ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏¢‡∏≠‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô */
.log{
  margin-top:0;
  background:#000;
  color:#0f0;
  font-size:12px;
  padding:6px;
  height:140px;
  overflow:auto;
  border-radius:6px;
}
</style>
</head>
<body>
<div class="container">

  <!-- LEFT -->
  <div class="left">

    <!-- TOP BAR -->
    <div class="topbar">
      <button class="btn-blue" onclick="modeImage()">üñº ‡∏†‡∏≤‡∏û</button>
      <button class="btn-purple" onclick="modeWork()">üß© ‡∏á‡∏≤‡∏ô</button>
      <button class="btn-green" onclick="modeVoice()">üé§ ‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
      <button class="btn-orange" onclick="modeSub()">‚úçÔ∏è ‡∏ã‡∏±‡∏ö</button>
    </div>

    <!-- PRESET SORA -->
    <div class="card">
      <h2>üé¨ Preset Sora</h2>
      <select id="presetSora" onchange="loadPreset()"></select>
      <input id="presetName" placeholder="‡∏ä‡∏∑‡πà‡∏≠ Preset">
      <textarea id="presetText" rows="4" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î Preset"></textarea>
      <div class="row">
        <button class="add" onclick="savePreset()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button class="del" onclick="deletePreset()">üóë ‡∏•‡∏ö</button>
      </div>
    </div>

    <!-- MENU -->
    <div id="menu"></div>

  </div>

<!-- RIGHT -->
<div class="right">

  <h2>üìÑ Sora Prompt</h2>
  <textarea id="result" class="output" readonly></textarea>

  <div class="row">
    <button class="copy" onclick="copySora()">üìã Copy (Sora Prompt)</button>
    <button class="send" onclick="sendGPT()">üöÄ Send GPT</button>
  </div>

  <hr style="margin:6px 0;border-color:#333">

  <h2>ü§ñ GPT Prompt</h2>
  <textarea id="gptPrompt" class="output" readonly></textarea>

  <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏° Copy GPT Prompt ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏±‡∏î‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô -->
  <button class="copy" onclick="copyGPT()">üìã Copy (GPT Prompt)</button>

  <div class="log" id="log">
    > Ready<br>
  </div>

</div>

</div>

<script>
/** =========================
 * CONFIG
 * ========================= */
const GPT_API_URL = "https://gpt-backend-xm93.onrender.com/api/generate-gpt-prompt";
/*
  ‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á backend ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö JSON ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÉ‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏´‡∏ô‡∏∂‡πà‡∏á:
  1) { success:true, prompt:"...." }
  2) { prompt:"...." }
  3) { data:{ prompt:"...." } }
*/

/** =========================
 * STORAGE + ELEMENTS
 * ========================= */
const LS="PROMPT_BUILDER_DATA";
const LS_PRESET="SORA_PRESETS";

const presetSora=document.getElementById("presetSora");
const presetName=document.getElementById("presetName");
const presetText=document.getElementById("presetText");
const result=document.getElementById("result");
const logBox=document.getElementById("log");
const gptBox=document.getElementById("gptPrompt");

/** =========================
 * HELPERS
 * ========================= */
function log(msg){
  logBox.innerHTML += `> ${msg}<br>`;
  logBox.scrollTop = logBox.scrollHeight;
}

function getValue(key){
  if(!data[key] || !data[key].enabled) return "";
  const s = document.getElementById(key + "_s");
  return s ? s.value : "";
}

/** =========================
 * SORA PRESETS
 * ========================= */
let soraPresets = JSON.parse(localStorage.getItem(LS_PRESET)) || {
  ugc:{name:"UGC ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤",text:"A vertical 9:16 UGC-style video.\nNatural lighting.\n15 seconds."}
};

function renderPresets(){
  presetSora.innerHTML="";
  Object.keys(soraPresets).forEach(k=>{
    const o=document.createElement("option");
    o.value=k;
    o.textContent=soraPresets[k].name;
    presetSora.appendChild(o);
  });
  loadPreset();
}

function loadPreset(){
  const p=soraPresets[presetSora.value];
  if(!p) return;
  presetName.value=p.name;
  presetText.value=p.text;
  update();
}

function savePreset(){
  if(!presetName.value) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ Preset");
  const k=presetName.value.toLowerCase().replace(/\s+/g,"_");
  soraPresets[k]={name:presetName.value,text:presetText.value};
  localStorage.setItem(LS_PRESET,JSON.stringify(soraPresets));
  renderPresets();
  presetSora.value=k;
}

function deletePreset(){
  if(!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö Preset ‡∏ô‡∏µ‡πâ ?")) return;
  delete soraPresets[presetSora.value];
  localStorage.setItem(LS_PRESET, JSON.stringify(soraPresets));
  renderPresets();
}

/** =========================
 * DATA SECTIONS (LEFT MENU)
 * ========================= */
let data=JSON.parse(localStorage.getItem(LS)) || {
  image:{enabled:false,items:["‡πÅ‡∏ï‡πà‡∏á‡∏†‡∏≤‡∏û 9:16"]},
  product:{enabled:false,items:["‡∏ó‡πá‡∏≠‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå"]},
  work:{enabled:false,items:["UGC ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß"]},
  model:{enabled:false,items:["‡∏ô‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢"]},
  style:{enabled:false,items:["Luxury"]},
  mood:{enabled:false,items:["‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô"]},
  voice:{enabled:false,items:["‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á"]},
  subtitle:{enabled:false,items:["‡∏ã‡∏±‡∏ö‡∏Ç‡∏≤‡∏¢"]}
};

function save(){localStorage.setItem(LS,JSON.stringify(data));}

function section(title,key){
  const c=data[key];
  if(!c.enabled) return "";
  return `
  <div class="card active" id="sec-${key}">
    <h2>${title}</h2>
    <select id="${key}_s" onchange="update()">
      ${c.items.map(v=>`<option>${v}</option>`).join("")}
    </select>
    <input id="${key}_i" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
    <div class="row">
      <button class="add" onclick="add('${key}')">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
      <button class="del" onclick="delItem('${key}')">üóë ‡∏•‡∏ö</button>
    </div>
  </div>`;
}

function render(){
  document.getElementById("menu").innerHTML =
    section("üñº ‡∏´‡∏°‡∏ß‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û","image")+
    section("üì¶ ‡∏´‡∏°‡∏ß‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤","product")+
    section("üß† ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô","work")+
    section("üë§ ‡∏ô‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö / ‡∏ô‡∏≤‡∏á‡πÅ‡∏ö‡∏ö","model")+
    section("üé¨ ‡∏™‡πÑ‡∏ï‡∏•‡πå VDO","style")+
    section("üå§ ‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®","mood")+
    section("üé§ ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏≤‡∏Å‡∏¢‡πå","voice")+
    section("‚úçÔ∏è ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ã‡∏±‡∏ö‡πÑ‡∏ï‡πÄ‡∏ï‡∏¥‡∏•","subtitle");
  update();
}

function toggle(k,v){
  data[k].enabled=v;
  save();
  render();
}

function add(k){
  const i=document.getElementById(k+"_i");
  if(!i.value) return;
  data[k].items.push(i.value);
  i.value="";
  save();
  render();
}

function delItem(k){
  const s=document.getElementById(k+"_s");
  if(!s) return;
  if(!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö "${s.value}" ?`)) return;
  data[k].items.splice(s.selectedIndex,1);
  save();
  render();
}

function line(t,k){
  if(!data[k].enabled) return "";
  const s=document.getElementById(k+"_s");
  return s?`${t}: ${s.value}\n`:"";
}

/** =========================
 * BUILD SORA PROMPT
 * ========================= */
function update(){
  const p=soraPresets[presetSora.value];
  result.value =
`###  ###
${p?p.text:""}

### DETAIL ###
${line("‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô1‡∏†‡∏≤‡∏û (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏™‡∏£‡πâ‡∏≤‡∏áPrompt) ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ","image")}
${line("‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤","product")}
${line("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô","work")}
${line("‡∏ô‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö/‡∏ô‡∏≤‡∏á‡πÅ‡∏ö‡∏ö","model")}
${line("‡∏™‡πÑ‡∏ï‡∏•‡πå","style")}
${line("‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®","mood")}
${line("‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏≤‡∏Å‡∏¢‡πå","voice")}
${line("‡∏ã‡∏±‡∏ö","subtitle")}`.trim();
}

/** =========================
 * MODES
 * ========================= */
function resetAll(){Object.keys(data).forEach(k=>data[k].enabled=false);}
function modeImage(){resetAll();["product","image"].forEach(k=>data[k].enabled=true);save();render();}
function modeWork(){resetAll();["product","work","model","style","mood"].forEach(k=>data[k].enabled=true);save();render();}
function modeVoice(){resetAll();["product","voice"].forEach(k=>data[k].enabled=true);save();render();}
function modeSub(){resetAll();["product","subtitle"].forEach(k=>data[k].enabled=true);save();render();}

/** =========================
 * COPY BUTTONS
 * ========================= */
function copySora(){
  result.select();
  navigator.clipboard.writeText(result.value);
  log("Copy Sora Prompt ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
}

function copyGPT(){
  gptBox.select();
  navigator.clipboard.writeText(gptBox.value || "");
  log("Copy GPT Prompt ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
}

/** =========================
 * SEND GPT (API)
 * ========================= */
async function sendGPT(){
  const soraPrompt = (result.value || "").trim();
  if(!soraPrompt){
    log("‚ùå Sora Prompt ‡∏ß‡πà‡∏≤‡∏á");
    return;
  }

  log("üöÄ Sending to GPT API...");
  try{
    const res = await fetch(GPT_API_URL, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ soraPrompt })
    });

    if(!res.ok){
      log(`‚ùå API Error: HTTP ${res.status}`);
      return;
    }

    const payload = await res.json();

    // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö response
    const prompt =
      (payload && payload.prompt) ||
      (payload && payload.data && payload.data.prompt) ||
      (payload && payload.success && payload.prompt) ||
      "";

    if(!prompt || !String(prompt).trim()){
      log("‚ùå API ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏û‡∏ö prompt");
      return;
    }

    gptBox.value = String(prompt).trim();
    log("‚úÖ ‡πÑ‡∏î‡πâ GPT Prompt ‡πÅ‡∏•‡πâ‡∏ß");
  }catch(err){
    console.error(err);
    log("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Backend ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL / CORS / Server)");
  }
}

/** =========================
 * INIT
 * ========================= */
renderPresets();
render();
</script>
</body>
</html>
